<!DOCTYPE html>
<html lang="en">


  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Source Report for JDBCAppender.java</title>
    <link href="resources/css/bootstrap.min.css" rel="stylesheet">
    <link href="resources/css/windup.css" rel="stylesheet" media="screen">
	  <link rel='stylesheet' type='text/css' href='resources/libraries/snippet/jquery.snippet.min.css' />
	  <link rel='stylesheet' type='text/css' href='resources/css/windup-source.css' />
	  <link rel='stylesheet' type='text/css' href='resources/libraries/sausage/sausage.css' />
  </head>
  <body role="document">
    
    <!-- Fixed navbar -->
    <div class="navbar-fixed-top windup-bar" role="navigation">
      <div class="container theme-showcase" role="main">
        <img src="resources/img/windup-logo.png" class="logo"/>
      </div>
    </div>


    <div class="container" role="main">
        <div class="row">
          <div class="page-header page-header-no-border">
            <h1>
              Source Report
              <span class="slash">/</span>
              <small style="margin-left: 20px; font-weight: 100;">jee-example-app-1.0.0.ear/jee-example-web.war/WEB-INF/lib/log4j-1.2.6.jar/org/apache/log4j/jdbc/JDBCAppender.java</small>
            </h1>
            <div class="navbar navbar-default">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="navbar-collapse collapse navbar-responsive-collapse">
	     <ol class="breadcrumb top-menu">
		<li><a href="../index.html">All Applications</a></li>
  <li><a href="JEE_Example_App__org_windup_example_jee_example_app_1_0_0_.1.html">JEE Example App (org.windup.example:jee-example-app:1.0.0)</a></li>
  
  <li><a href="JDBCAppender_java.1.html">JDBCAppender.java</a></li>
  
	     </ol> 
            </div>
            <div class="navbar-collapse collapse navbar-responsive-collapse">
              <ul class="nav navbar-nav">
  <li><a href="JEE_Example_App__org_windup_example_jee_example_app_1_0_0_.1.html">Overview</a></li>
  <li><a href="ignoredfiles_JEE_Example_App__org_windup_example_jee_example_app_1_0_0_.1.html">Ignored Files</a></li>
  <li><a href="nonclassifiedfiles_JEE_Example_App__org_windup_example_jee_example_app_1_0_0_.1.html">Unclassified Files</a></li>
              </ul>
            </div><!-- /.nav-collapse -->
            </div>
          </div>
        </div>
    </div>



    <div class="container theme-showcase" role="main">

    <div class="panel panel-default">
    	<div class="panel-heading">Information</div>
    	<div class="panel-body">
	        <ul>
	          <li>Estimated Story Points: 0</li>
		          <li>
	              		<span class="label label-info">Decompiled Java File</span>
	              		<span class="label label-info">Java Source</span>
	              </li>
            </ul>
        
            <ul>
            </ul>
		</div>
      </div>
    
    

<pre id='source'>package org.apache.log4j.jdbc;

import org.apache.log4j.Layout;
import org.apache.log4j.PatternLayout;
import java.util.Iterator;
import java.util.Collection;
import java.sql.DriverManager;
import java.sql.Statement;
import java.sql.SQLException;
import org.apache.log4j.spi.LoggingEvent;
import java.util.ArrayList;
import java.sql.Connection;
import org.apache.log4j.Appender;
import org.apache.log4j.AppenderSkeleton;

public class JDBCAppender extends AppenderSkeleton implements Appender{
    protected String databaseURL;
    protected String databaseUser;
    protected String databasePassword;
    protected Connection connection;
    protected String sqlStatement;
    protected int bufferSize;
    protected ArrayList buffer;
    protected ArrayList removes;
    public JDBCAppender(){
        super();
        this.databaseURL=&quot;jdbc:odbc:myDB&quot;;
        this.databaseUser=&quot;me&quot;;
        this.databasePassword=&quot;mypassword&quot;;
        this.connection=null;
        this.sqlStatement=&quot;&quot;;
        this.bufferSize=1;
        this.buffer=new ArrayList(this.bufferSize);
        this.removes=new ArrayList(this.bufferSize);
    }
    public void append(final LoggingEvent event){
        this.buffer.add(event);
        if(this.buffer.size()&gt;=this.bufferSize){
            this.flushBuffer();
        }
    }
    protected String getLogStatement(final LoggingEvent event){
        return this.getLayout().format(event);
    }
    protected void execute(final String sql) throws SQLException{
        Connection con=null;
        Statement stmt=null;
        try{
            con=this.getConnection();
            stmt=con.createStatement();
            stmt.executeUpdate(sql);
        }
        catch(SQLException e){
            if(stmt!=null){
                stmt.close();
            }
            throw e;
        }
        stmt.close();
        this.closeConnection(con);
    }
    protected void closeConnection(final Connection con){
    }
    protected Connection getConnection() throws SQLException{
        if(!DriverManager.getDrivers().hasMoreElements()){
            this.setDriver(&quot;sun.jdbc.odbc.JdbcOdbcDriver&quot;);
        }
        if(this.connection==null){
            this.connection=DriverManager.getConnection(this.databaseURL,this.databaseUser,this.databasePassword);
        }
        return this.connection;
    }
    public void close(){
        this.flushBuffer();
        try{
            if(this.connection!=null&amp;&amp;!this.connection.isClosed()){
                this.connection.close();
            }
        }
        catch(SQLException e){
            super.errorHandler.error(&quot;Error closing connection&quot;,e,0);
        }
        super.closed=true;
    }
    public void flushBuffer(){
        this.removes.ensureCapacity(this.buffer.size());
        final Iterator i=this.buffer.iterator();
        while(i.hasNext()){
            try{
                final LoggingEvent logEvent=i.next();
                final String sql=this.getLogStatement(logEvent);
                this.execute(sql);
                this.removes.add(logEvent);
            }
            catch(SQLException e){
                super.errorHandler.error(&quot;Failed to excute sql&quot;,e,2);
            }
        }
        this.buffer.removeAll(this.removes);
    }
    public void finalize(){
        this.close();
    }
    public boolean requiresLayout(){
        return true;
    }
    public void setSql(final String s){
        this.sqlStatement=s;
        if(this.getLayout()==null){
            this.setLayout(new PatternLayout(s));
        }
        else{
            ((PatternLayout)this.getLayout()).setConversionPattern(s);
        }
    }
    public String getSql(){
        return this.sqlStatement;
    }
    public void setUser(final String user){
        this.databaseUser=user;
    }
    public void setURL(final String url){
        this.databaseURL=url;
    }
    public void setPassword(final String password){
        this.databasePassword=password;
    }
    public void setBufferSize(final int newBufferSize){
        this.bufferSize=newBufferSize;
        this.buffer.ensureCapacity(this.bufferSize);
        this.removes.ensureCapacity(this.bufferSize);
    }
    public String getUser(){
        return this.databaseUser;
    }
    public String getURL(){
        return this.databaseURL;
    }
    public String getPassword(){
        return this.databasePassword;
    }
    public int getBufferSize(){
        return this.bufferSize;
    }
    public void setDriver(final String driverClass){
        try{
            Class.forName(driverClass);
        }
        catch(Exception e){
            super.errorHandler.error(&quot;Failed to load driver&quot;,e,0);
        }
    }
}
</pre>	
    </div> <!-- /container -->

    <script src="resources/js/jquery-1.7.min.js"></script>
    <script src="resources/js/bootstrap.min.js"></script>
    
	<script type='text/javascript' src='resources/libraries/jquery-ui/jquery.ui.widget.js'></script>
	<script type='text/javascript' src='resources/libraries/snippet/jquery.snippet.min.js'></script>
	<script type='text/javascript' src='resources/libraries/snippet/jquery.snippet.java-properties.js'></script>
	<script type='text/javascript' src='resources/libraries/snippet/jquery.snippet.java-manifest.js'></script>
	<script type='text/javascript' src='resources/libraries/sausage/jquery.sausage.min.js'></script>

    
	    
	<script type='text/javascript'>
		$(document).ready(function(){
			$('pre').snippet('java',{style:'ide-eclipse', showNum:true,boxFill:'#ffeeb9', box: '7' });
	
			$("<div id='7-inlines' class='inline-source-hint-group'/>").appendTo('ol.snippet-num li:nth-child(7)');
		
			
$("<a name='3968512'></a><div class='inline-source-comment green'><div class='inline-comment'><div class='inline-comment-heading'><strong class='notification 0'>Migrate to JCA Connector</strong></div></div></div>").appendTo('#7-inlines');


		
			$('code[data-code-syntax]').each(function(){
		         var codeSyntax = ($(this).data('code-syntax'));
		         if(codeSyntax) {
		            $(this).parent().snippet(codeSyntax,{style:'ide-eclipse', menu:false, showNum:false});
		         }
			});
			$(window).sausage({ page: 'li.box' });
		}); 
	</script>
    
  </body>
</html>
